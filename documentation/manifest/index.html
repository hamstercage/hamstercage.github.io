<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Manifest - Hamstercage</title><meta name=description content="All information about file entries is stored in the manifest file hamstercage.yaml. This YAML file consists of these top-level entries:
hosts: each entry describes one host, in particular the set of tags that apply to it tags: each entry contains a list of files managed for this tag This is a very minimal example with one host, one tag and one file:
hosts: testing.example.com: description: '' tags: - all tags: all: description: files that apply to all hosts entries: /etc/profile: group: root mode: 0o444 owner: root type: file Hosts Each entry in this dict defines one host."><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Hamstercage","url":"https:\/\/hamstercage.io\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/hamstercage.io\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/hamstercage.io\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/hamstercage.io\/documentation\/manifest\/","name":"Manifest"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":""},"headline":"Manifest","description":"All information about file entries is stored in the manifest file hamstercage.yaml. This YAML file consists of these top-level entries:\nhosts: each entry describes one host, in particular the set of tags that apply to it tags: each entry contains a list of files managed for this tag This is a very minimal example with one host, one tag and one file:\nhosts: testing.example.com: description: \u0026#39;\u0026#39; tags: - all tags: all: description: files that apply to all hosts entries: \/etc\/profile: group: root mode: 0o444 owner: root type: file Hosts Each entry in this dict defines one host.","inLanguage":"en","wordCount":752,"datePublished":"0001-01-01T00:00:00","dateModified":"0001-01-01T00:00:00","image":"https:\/\/hamstercage.io\/","keywords":[""],"mainEntityOfPage":"https:\/\/hamstercage.io\/documentation\/manifest\/","publisher":{"@type":"Organization","name":"https:\/\/hamstercage.io\/","logo":{"@type":"ImageObject","url":"https:\/\/hamstercage.io\/","height":60,"width":60}}}</script><meta property="og:title" content="Manifest"><meta property="og:description" content="All information about file entries is stored in the manifest file hamstercage.yaml. This YAML file consists of these top-level entries:
hosts: each entry describes one host, in particular the set of tags that apply to it tags: each entry contains a list of files managed for this tag This is a very minimal example with one host, one tag and one file:
hosts: testing.example.com: description: '' tags: - all tags: all: description: files that apply to all hosts entries: /etc/profile: group: root mode: 0o444 owner: root type: file Hosts Each entry in this dict defines one host."><meta property="og:url" content="https://hamstercage.io/documentation/manifest/"><meta property="og:type" content="website"><meta property="og:site_name" content="Hamstercage"><meta name=twitter:title content="Manifest"><meta name=twitter:description content="All information about file entries is stored in the manifest file hamstercage.yaml. This YAML file consists of these top-level entries:
hosts: each entry describes one host, in particular the set of …"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.100.1"><link rel=alternate href=https://hamstercage.io/index.xml type=application/rss+xml title=Hamstercage><link rel=stylesheet href=https://hamstercage.io/css/katex.min.css><link rel=stylesheet href=https://hamstercage.io/fontawesome/css/all.css><link rel=stylesheet href=https://hamstercage.io/css/bootstrap.min.css><link rel=stylesheet href=https://hamstercage.io/css/main.css><link rel=stylesheet href=https://hamstercage.io/css/fonts.css><link rel=stylesheet href=https://hamstercage.io/css/syntax.css><link rel=stylesheet href=https://hamstercage.io/css/codeblock.css><link rel=stylesheet href=https://hamstercage.io/css/photoswipe.min.css><link rel=stylesheet href=https://hamstercage.io/css/photoswipe.default-skin.min.css></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class=navbar-brand href=https://hamstercage.io/>Hamstercage</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Home href=/>Home</a></li><li><a title=Documentation href=/documentation/>Documentation</a></li><li><a title=Blog href=/posts/>Blog</a></li></ul></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><div id=header-big-imgs data-num-img=1 data-img-src-1=/img/organ-manual.jpg></div><header class="header-section has-img"><div class="intro-header big-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=page-heading><h1>Manifest</h1></div></div></div></div><span class=img-desc style=display:inline></span></div><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=page-heading><h1>Manifest</h1><hr class=small></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><p>All information about file entries is stored in the manifest file <code>hamstercage.yaml</code>. This <a href=https://yaml.org>YAML</a> file consists of these top-level entries:</p><ul><li><code>hosts</code>: each entry describes one host, in particular the set of tags that apply to it</li><li><code>tags</code>: each entry contains a list of files managed for this tag</li></ul><p>This is a very minimal example with one host, one tag and one file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>hosts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>testing.example.com</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>tags</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>all</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tags</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>all</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>files that apply to all hosts</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>entries</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>/etc/profile</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>group</span><span class=p>:</span><span class=w> </span><span class=l>root</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=m>0o444</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>owner</span><span class=p>:</span><span class=w> </span><span class=l>root</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>file</span><span class=w>
</span></span></span></code></pre></div><h2 id=hosts>Hosts</h2><p>Each entry in this dict defines one host. Hosts are distinguished by their fully-qualified hostname. When running Hamstercage, you can override the hostname by specifying the <code>-h</code> option. Each host definition can have these fields:</p><ul><li><code>description</code>: allows you to add a description or note to this entry. Optional.</li><li><code>tags</code>: a list of one or more tags to apply to this host.</li></ul><h2 id=tags>Tags</h2><p>Each entry in this dict defines one tag. Tag names can be freely chosen; it is recommended to stick to alpha-numeric identifiers though, to keep the names compatible with shell scripts, etc. Each entry has these fields:</p><ul><li><code>description</code>: allows you to add a description or note to this entry. Optional.</li><li><code>entries</code>: a dict of files managed through this tag. See below for details.</li><li><code>hooks</code>: a dict of hook scripts that will be run. See below for details.</li></ul><h2 id=tags-entries>Tags: Entries</h2><p>The entries field in a tag entry describes files, directories, and symbolic links that are managed through that tag. Each entry can have these fields:</p><ul><li><code>group</code>: the group name owning this file.</li><li><code>mode</code>: the access mode for this file. You need to specify the mode as an octal number (<code>0o644</code>) or as a string in quotes (<code>"644"</code>). If you simply give a number, it will be interpreted as a base-10 integer, leading to unexpected mode bits</li><li><code>owner</code>: the user name owning this file.</li><li><code>target</code>: the path the link points to, only applicable to <code>type</code>=<code>link</code></li><li><code>type</code>: must be one of <code>dir</code>, <code>file</code>, or <code>link</code>.</li></ul><p>Note that Hamstercage only manages symbolic links (soft links). Hard links are not supported.</p><h2 id=tags-hooks>Tags: Hooks</h2><p>The <code>hooks</code> dict in a tag allows you to hook scripts into Hamstercages execution. The name of each entry defines when to run the script; the contents of the dict define what command to execute.</p><p>The name consists of two parts separated by a dash: the prefix <code>pre</code> or <code>post</code>, and the name of the Hamstercage command. For example, the hook defined by the name <code>pre-save</code> will be executed when you run <code>hamstercage save</code>, just before the contents of the files will be copied from the target system to the repository. A hook <code>post-apply</code> will be run right after all files have been updated by the command <code>hamstercage apply</code>.</p><p>Hamstercage searches for a matching hook definition in this order:</p><ol><li>for the exact match <em>step</em><code>-</code><em>command</em> (for example, <code>pre-save</code>)</li><li>for the wildcard match <code>*-</code><em>command</em> (for example, <code>*-save</code>)</li><li>for the wildcard match <em>step</em><code>-*</code> (for example, <code>pre-*</code>)</li><li>for the fallback wildcard <code>*</code>.</li></ol><p>Only the first match found will be executed.</p><p>Each entry has these fields:</p><ul><li><code>command</code>: the command or script to execute.</li><li><code>description</code>: allows you to add a description or note to this entry. Optional.</li><li><code>type</code>: the type of command or script to run.<ul><li><code>exec</code>: run the program specified by <code>command</code>. If <code>command</code> is not an absolute path, the system will search for it on the <code>PATH</code>. See <a href=https://docs.python.org/3/library/subprocess.html#subprocess.Popen>subprocess.Popen</a> for details. The command will be invoked with the Hamstercage command, the step, and the tag the hook is defined in as parameters, for example <code>.../myhook.sh apply post all</code>.</li><li><code>python</code>: <code>command</code> should specify a Python script. A relative path is interpreted relative to the repository directory. See below for global variables available to the script.</li><li><code>shell</code>: run <code>command</code> through the shell. Typically, this will be the shell of the user running Hamstercage.</li></ul></li></ul><p>The <code>exec</code> and <code>shell</code> hooks receive the following environment variables:</p><ul><li><code>HAMSTERCAGE_CMD</code>: the command being executed</li><li><code>HAMSTERCAGE_MANIFEST</code>: the manifest file path name</li><li><code>HAMSTERCAGE_HOOK</code>: the name of the hook entry</li><li><code>HAMSTERCAGE_REPO</code>: the repo directory, which is the directory the manifest file lives in</li><li><code>HAMSTERCAGE_STEP</code>: the step (<code>pre</code> or <code>post</code>)</li><li><code>HAMSTERCAGE_TAG</code>: the tag name this hook is defined in</li></ul><p>The <code>python</code> script receives these global variables:</p><ul><li><code>cmd</code>: the command being executed</li><li><code>manifest</code>: the manifest object</li><li><code>hook</code>: the name of the hook entry</li><li><code>repo</code>: the repo directory, which is the directory the manifest file lives in</li><li><code>step</code>: the step (<code>pre</code> or <code>post</code>)</li><li><code>tag</code>: the tag object this hook is defined in</li><li><code>__file__</code>: the Python hook file</li><li><code>__name__</code>: the constant <code>__hamstercage__</code>.</li></ul></article></div></div></div><div class=page-meta></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"></ul><p class="credits text-muted">© 2022 Stefan Bethke and Hamstercage Contributors. <a href=https://github.com/halogenica/beautifulhugo>Theme Beautiful Hugo</a></p></div></div></div></footer><script src=https://hamstercage.io/js/katex.min.js></script>
<script src=https://hamstercage.io/js/auto-render.min.js></script>
<script src=https://hamstercage.io/js/jquery.min.js></script>
<script src=https://hamstercage.io/js/bootstrap.min.js></script>
<script src=https://hamstercage.io/js/main.js></script><script>renderMathInElement(document.body)</script><script src=https://hamstercage.io/js/photoswipe.min.js></script>
<script src=https://hamstercage.io/js/photoswipe-ui-default.min.js></script><script src=https://hamstercage.io/js/load-photoswipe.js></script></body></html>