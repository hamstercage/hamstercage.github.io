<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Theory of Operation - Hamstercage</title><meta name=description content="Hamstercage keeps a list of files under management in a manifest file, by default hamstercage.yaml. The various Hamstercage commands can be used to add, update, and remove files from the manifest, but you can always make changes manually, for example to correct the owner or mode of a file.
Managed files are kept not as a single list, but as multiple lists, one for each tag. A tag is simply a label for a set of files."><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Hamstercage","url":"https:\/\/hamstercage.io\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/hamstercage.io\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/hamstercage.io\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/hamstercage.io\/documentation\/theory-of-operation\/","name":"Theory of operation"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":""},"headline":"Theory of Operation","description":"Hamstercage keeps a list of files under management in a manifest file, by default hamstercage.yaml. The various Hamstercage commands can be used to add, update, and remove files from the manifest, but you can always make changes manually, for example to correct the owner or mode of a file.\nManaged files are kept not as a single list, but as multiple lists, one for each tag. A tag is simply a label for a set of files.","inLanguage":"en","wordCount":827,"datePublished":"0001-01-01T00:00:00","dateModified":"0001-01-01T00:00:00","image":"https:\/\/hamstercage.io\/","keywords":[""],"mainEntityOfPage":"https:\/\/hamstercage.io\/documentation\/theory-of-operation\/","publisher":{"@type":"Organization","name":"https:\/\/hamstercage.io\/","logo":{"@type":"ImageObject","url":"https:\/\/hamstercage.io\/","height":60,"width":60}}}</script><meta property="og:title" content="Theory of Operation"><meta property="og:description" content="Hamstercage keeps a list of files under management in a manifest file, by default hamstercage.yaml. The various Hamstercage commands can be used to add, update, and remove files from the manifest, but you can always make changes manually, for example to correct the owner or mode of a file.
Managed files are kept not as a single list, but as multiple lists, one for each tag. A tag is simply a label for a set of files."><meta property="og:url" content="https://hamstercage.io/documentation/theory-of-operation/"><meta property="og:type" content="website"><meta property="og:site_name" content="Hamstercage"><meta name=twitter:title content="Theory of Operation"><meta name=twitter:description content="Hamstercage keeps a list of files under management in a manifest file, by default hamstercage.yaml. The various Hamstercage commands can be used to add, update, and remove files from the manifest, but â€¦"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.100.1"><link rel=alternate href=https://hamstercage.io/index.xml type=application/rss+xml title=Hamstercage><link rel=stylesheet href=https://hamstercage.io/css/katex.min.css><link rel=stylesheet href=https://hamstercage.io/fontawesome/css/all.css><link rel=stylesheet href=https://hamstercage.io/css/bootstrap.min.css><link rel=stylesheet href=https://hamstercage.io/css/main.css><link rel=stylesheet href=https://hamstercage.io/css/fonts.css><link rel=stylesheet href=https://hamstercage.io/css/syntax.css><link rel=stylesheet href=https://hamstercage.io/css/codeblock.css><link rel=stylesheet href=https://hamstercage.io/css/photoswipe.min.css><link rel=stylesheet href=https://hamstercage.io/css/photoswipe.default-skin.min.css></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class=navbar-brand href=https://hamstercage.io/>Hamstercage</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Home href=/>Home</a></li><li><a title=Documentation href=/documentation/>Documentation</a></li><li><a title=Blog href=/posts/>Blog</a></li></ul></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><div id=header-big-imgs data-num-img=1 data-img-src-1=/img/math-work.jpg></div><header class="header-section has-img"><div class="intro-header big-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=page-heading><h1>Theory of Operation</h1></div></div></div></div><span class=img-desc style=display:inline></span></div><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=page-heading><h1>Theory of Operation</h1><hr class=small></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><p>Hamstercage keeps a list of files under management in a <strong>manifest</strong> file, by default <code>hamstercage.yaml</code>. The various Hamstercage commands can be used to add, update, and remove files from the manifest, but you can always make changes manually, for example to correct the owner or mode of a file.</p><p>Managed files are kept not as a single list, but as multiple lists, one for each <strong>tag</strong>. A tag is simply a label for a set of files. You are free to choose tags to organize sets of files as you see fit, for example, by purpose, application, operating system, or any other metric.</p><p>In addition to the managed files, the manifest also contains a list of <strong>hostnames</strong>, with the tags that should be applied to each hostname. This allows you to run the same Hamstercage command across multiple hosts and have files applied according to the hosts&rsquo; respective tags.</p><p>The contents of files is kept alongside the manifest, using the path of the target. For example, a target file <code>/etc/profile</code> would be stored in <code>tags/all/etc/profile</code>.</p><p>While Hamstercage manages files very efficiently, there are some configuration tasks that require manipulation of existing files, refreshing a set of files, or restarting a daemon. Hamstercage does not attempt to implement any such actions. <strong>Hooks</strong> allow you to supply your own custom logic for these kinds of actions. You can define hooks to run before or after a command is executed (for example before a <code>save</code> or after an <code>apply</code>). Hooks are defined on tags, so you can cater the commands to the set of files that are managed. Hooks can be individual shell commands, any executable including scripts, or Python programs that are executed inside Hamstercage&rsquo;s Python process.</p><p>Hooks are called for these commands:</p><ul><li><a href=../command-reference/#adding-files-add><code>apply</code></a></li><li><a href=../command-reference/#determining-differences-diff><code>diff</code></a></li><li><a href=../command-reference/#save-target-to-repository-save><code>save</code></a></li></ul><p>This is a very minimal example with one host, one tag and one file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>hosts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>testing.example.com</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>tags</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>all</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tags</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>all</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>files that apply to all hosts</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>entries</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>/etc/profile</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>group</span><span class=p>:</span><span class=w> </span><span class=l>root</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=m>0o444</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>owner</span><span class=p>:</span><span class=w> </span><span class=l>root</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>file</span><span class=w>
</span></span></span></code></pre></div><h2 id=interaction-with-version-control-systems>Interaction with version control systems</h2><p>Hamstercage is designed to produce a repository that can be checked in and managed through a version control system like Git. Hamstercage does not make any assumptions about how that system works, so you can use whichever system you prefer.</p><h2 id=permissions-in-the-repo>Permissions in the repo</h2><p>When you add a file to a tag in the repo, Hamstercage copies the contents of the file from the target. The owner, group, and permissions of the file are added to the metadata in the manifest, but the file in the repo will receive the same owner, group, and permissions as the manifest file. For example, if you add <code>/etc/profile</code> to the repo (which is not executable), the file in the repo will be owned by the same account as the manifest, and the file mode will be the same as the manifest. When you add a file that has the execute bit set, that will be set on the repo file as well.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ ls -ld hamstercage.yaml /etc/profile tags/all/etc/profile
</span></span><span class=line><span class=cl>-rw-r--r--  1 root  wheel   488 Nov  1  2020 /etc/profile
</span></span><span class=line><span class=cl>-rw-r--r--  1 root  wheel  5152 Jun  4 22:31 hamstercage.yaml
</span></span><span class=line><span class=cl>-rw-rw----  1 root  wheel  1130 Jan 21  2017 tags/all/etc/profile
</span></span></code></pre></div><p>In the above example, the repository directory has group wheel, and only the user and group have access to it; all the files in the tags have ownership and permissions accordingly.</p><p>This allows you to control who has access to the Hamstercage repo and its contents. If you share admin duties for the machines with other people, you can put the repo into a shared directory, but adjust the ownership and permissions so that only the admins have access.</p><p>For best results interacting with the version control system, you should make sure that your umask is set to <code>002</code>, so that files created by your version control system are group-writable. This ensures that your fellow admins can edit files without having to change their permissions first.</p><h2 id=managing-the-same-file-in-multiple-tags>Managing the same file in multiple tags</h2><p>When using multiple tags, it is possible that a file in the target has an entry in more than one tag. Consider this manifest:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>hosts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>testing.example.com</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>tags</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>jumphost</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>all</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>web.example.com</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>tags</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>web</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>all</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tags</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>all</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>files that apply to all hosts</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>entries</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>/etc/profile</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>group</span><span class=p>:</span><span class=w> </span><span class=l>root</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=m>0o444</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>owner</span><span class=p>:</span><span class=w> </span><span class=l>root</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jumphost</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>files that apply only to jumphosts</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>entries</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>/etc/profile</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>group</span><span class=p>:</span><span class=w> </span><span class=l>root</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=m>0o444</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>owner</span><span class=p>:</span><span class=w> </span><span class=l>root</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>web</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>files that apply only to jumphosts</span><span class=w>
</span></span></span></code></pre></div><p>The file <code>/etc/profile</code> is kept in the repository both in the <code>all</code> and in the <code>jumphosts</code> tags.</p><p>When processing files, Hamstercage will always consider the entry in the first tag that defines it. When applying or saving the files on <code>testing.example.com</code>, the entry in <code>jumphost</code> will be selected, because the tag <code>jumphost</code> comes first in the list of tags for that host. On <code>web.example.com</code>, no entry exists in the tag <code>web</code>, so the entry in <code>all</code>is selected.</p></article></div></div></div><div class=page-meta></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"></ul><p class="credits text-muted">Â© 2022 Stefan Bethke and Hamstercage Contributors. <a href=https://github.com/halogenica/beautifulhugo>Theme Beautiful Hugo</a></p></div></div></div></footer><script src=https://hamstercage.io/js/katex.min.js></script>
<script src=https://hamstercage.io/js/auto-render.min.js></script>
<script src=https://hamstercage.io/js/jquery.min.js></script>
<script src=https://hamstercage.io/js/bootstrap.min.js></script>
<script src=https://hamstercage.io/js/main.js></script><script>renderMathInElement(document.body)</script><script src=https://hamstercage.io/js/photoswipe.min.js></script>
<script src=https://hamstercage.io/js/photoswipe-ui-default.min.js></script><script src=https://hamstercage.io/js/load-photoswipe.js></script></body></html>